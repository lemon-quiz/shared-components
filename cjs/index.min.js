"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react"),n=require("@material-ui/core/Button"),r=require("@material-ui/core/Dialog"),a=require("@material-ui/core/DialogActions"),l=require("@material-ui/core/DialogContent"),u=require("@material-ui/core/DialogContentText"),o=require("@material-ui/core/DialogTitle"),i=require("@material-ui/core"),d=require("@material-ui/icons"),s=require("react-transition-group"),c=require("@material-ui/icons/ArrowDropUp"),f=require("rxjs"),p=require("rxjs/operators"),m=require("uuid"),v=require("@material-ui/styles"),g=require("@material-ui/core/colors"),h=require("@material-ui/core/Snackbar"),E=require("@material-ui/lab/Alert"),y=require("next/router"),_=require("@material-ui/core/styles"),b=require("moment"),x=require("final-form");function C(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function A(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var S=A(t),P=C(t),N=C(n),w=C(r),I=C(a),B=C(l),k=C(u),T=C(o),D=C(c),F=C(h),L=C(E),q=C(b),R=S.createContext({});function O(e){var t=e.open,n=e.title,r=e.content,a=e.submitLabel,l=e.cancelLabel,u=e.handleClose;return P.default.createElement(w.default,{open:t,onClose:function(){return u(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},P.default.createElement(T.default,{id:"alert-dialog-title"},n),P.default.createElement(B.default,null,P.default.createElement(k.default,{id:"alert-dialog-description",dangerouslySetInnerHTML:{__html:r}})),P.default.createElement(I.default,null,P.default.createElement(N.default,{onClick:function(){return u(!1)},color:"primary"},null!=l?l:"Cancel"),P.default.createElement(N.default,{onClick:function(){return u(!0)},color:"primary",autoFocus:!0},null!=a?a:"Submit")))}R.Provider,R.Consumer;var V=P.default.createContext(null);function Q(e){return""+e}function U(n){var r=n.node,a=n.path,l=n.index,u=n.length,o=t.useContext(V),d=t.useState(0),s=d[0],c=d[1],f=t.useState(0),p=f[0],m=f[1];t.useEffect((function(){var e=o.getSiblings(a);c(e.length),m(e.length)}),[l,u]);var v=r.config;return P.default.createElement(i.Slider,e.__assign({value:s,getAriaValueText:Q,"aria-labelledby":"discrete-slider",valueLabelDisplay:"auto",step:1,marks:!0,min:0,max:100,onChangeCommitted:function(e,t){if(t>p){var n=t-p;return o.addNode(a,void 0,n),void m(t)}if(t<p){var r=p-t;o.deleteNode(a,r),m(t)}},onChange:function(e,t){c(t)}},null==v?void 0:v.slider))}function j(e){var n=e.node,r=e.index,a=e.path,l=e.length,u=t.useContext(V),o=t.useState({canMoveUp:!1,canMoveDown:!1,canAdd:!1,canDelete:!1}),s=o[0],c=o[1];return t.useEffect((function(){c({canMoveUp:u.canMoveUp(a,r,n.type,n.name),canMoveDown:u.canMoveDown(a,r,n.type,n.name),canAdd:u.canAdd(a),canDelete:u.canDelete(a)})}),[r,l]),P.default.createElement(P.default.Fragment,null,P.default.createElement(i.IconButton,{onClick:function(){u.moveUp(a)},disabled:!s.canMoveUp,component:"span",color:"primary",size:"small"},P.default.createElement(D.default,null)),P.default.createElement(i.IconButton,{onClick:function(){u.moveDown(a)},disabled:!s.canMoveDown,component:"span",color:"primary",size:"small"},P.default.createElement(d.ArrowDropDown,null)),P.default.createElement(i.IconButton,{onClick:function(){n.uuid?u.addNode(a,r):u.addNode(a)},disabled:!s.canAdd,component:"span",color:"primary",size:"small"},P.default.createElement(d.AddBox,null)),P.default.createElement(i.IconButton,{onClick:function(){u.deleteNode(a)},disabled:!s.canDelete,component:"span",color:"primary",size:"small"},P.default.createElement(d.Delete,null)))}function M(n){var r=n.node,a=t.useContext(V),l=t.useState(!1),u=l[0],o=l[1],d=t.useState(null),s=d[0],c=d[1];t.useEffect((function(){var e=r.value;void 0!==e&&o(e)}),[r.uuid]),t.useEffect((function(){var e=r.errors;e&&c(e)}),[null==r?void 0:r.errors]);var f=function(t){o((function(n){var l,u=t.target,o=u.checked,i=u.value,d=e.__assign({},n);(null===(l=r.options)||void 0===l?void 0:l.length)>0?("object"!=typeof d&&(d={}),d[i]=o):d=o;var s=a.validateNode(r,d);return a.setValue(r.uuid,d,s),c(s),d}))},p=function(e){var t,n;return(null===(t=r.options)||void 0===t?void 0:t.length)>0?null!==(n=u[e])&&void 0!==n&&n:!!u},m=r.config;return P.default.createElement(P.default.Fragment,null,P.default.createElement(i.FormControl,{error:null!==s,fullWidth:!0},P.default.createElement(i.FormGroup,null,(r.options||[{value:!1,desc:r.name}]).map((function(t){return P.default.createElement(i.FormControlLabel,e.__assign({key:r.name+"-"+String(t.value),control:P.default.createElement(i.Checkbox,e.__assign({checked:p(t.value),onChange:f,name:t.desc,value:t.value},null==m?void 0:m.checkbox)),label:t.desc},null==m?void 0:m.label))}))),null!==s&&P.default.createElement(i.FormHelperText,{id:"input-"+r.uuid+"-error"},Object.keys(s).map((function(e){return P.default.createElement("span",{key:r.uuid+"-"+e},e)})))))}function H(e){var n=e.node,r=t.useContext(V),a=n.type,l=r.getCustomNode(a);return l?P.default.createElement(l,{node:n}):P.default.createElement(P.default.Fragment,null)}function z(n){var r=n.node,a=t.useContext(V),l=t.useState(""),u=l[0],o=l[1],d=t.useState(null),s=d[0],c=d[1];t.useEffect((function(){var e=r.value;void 0!==e&&o(e)}),[r.uuid]),t.useEffect((function(){var e=r.errors;e&&c(e)}),[null==r?void 0:r.errors]);var f=r.config;return P.default.createElement(P.default.Fragment,null,P.default.createElement(i.FormControl,{error:null!==s,fullWidth:!0},P.default.createElement(i.InputLabel,{htmlFor:"input-"+r.uuid},r.label),P.default.createElement(i.Input,e.__assign({id:"input-"+r.uuid,value:u,onChange:function(e){var t=e.target.value,n=a.validateNode(r,t);a.setValue(r.uuid,t,n),o(t),c(n)},"aria-describedby":"input-"+r.uuid+"-error"},null==f?void 0:f.input)),null!==s&&P.default.createElement(i.FormHelperText,{id:"input-"+r.uuid+"-error"},Object.keys(s).map((function(e){return P.default.createElement("span",{key:r.uuid+"-"+e},e)})))))}function G(n){var r,a=n.node,l=t.useContext(V),u=t.useState(""),o=u[0],d=u[1],s=t.useState(null),c=s[0],f=s[1];t.useEffect((function(){var e=a.value;void 0!==e&&d(e)}),[a.uuid]),t.useEffect((function(){var e=a.errors;e&&f(e)}),[null==a?void 0:a.errors]);var p=a.config;return P.default.createElement(P.default.Fragment,null,P.default.createElement(i.FormControl,{error:null!==c,fullWidth:!0},P.default.createElement(i.RadioGroup,e.__assign({value:o,onChange:function(e){var t=e.target.value,n=l.validateNode(a,t);l.setValue(a.uuid,t,n),d(t),f(n)}},null==p?void 0:p.group),null===(r=null==a?void 0:a.options)||void 0===r?void 0:r.map((function(t){var n=t.value,r=t.desc;return P.default.createElement(i.FormControlLabel,e.__assign({key:n,value:n,control:P.default.createElement(i.Radio,e.__assign({},null==p?void 0:p.radio)),label:r},null==p?void 0:p.label))}))),null!==c&&P.default.createElement(i.FormHelperText,{id:"input-"+a.uuid+"-error"},Object.keys(c).map((function(e){return P.default.createElement("span",{key:a.uuid+"-"+e},e)})))))}function W(n){var r,a=n.node,l=t.useContext(V),u=t.useState(""),o=u[0],d=u[1],s=t.useState(null),c=s[0],f=s[1];t.useEffect((function(){var e=a.value;void 0!==e&&d(e)}),[a.uuid]),t.useEffect((function(){var e=a.errors;e&&f(e)}),[null==a?void 0:a.errors]);var p=a.config;return P.default.createElement(P.default.Fragment,null,P.default.createElement(i.FormControl,{error:null!==c,fullWidth:!0},P.default.createElement(i.Select,e.__assign({value:o,onChange:function(e){var t=e.target.value,n=l.validateNode(a,t);l.setValue(a.uuid,t,n),d(t),f(n)}},null==a?void 0:a.select),null===(r=null==a?void 0:a.options)||void 0===r?void 0:r.map((function(t){var n=t.value,r=t.desc;return P.default.createElement(i.MenuItem,e.__assign({key:n,value:n},null==p?void 0:p.option),r)}))),null!==c&&P.default.createElement(i.FormHelperText,{id:"input-"+a.uuid+"-error"},Object.keys(c).map((function(e){return P.default.createElement("span",{key:a.uuid+"-"+e},e)})))))}function J(n){var r=n.node,a=t.useContext(V),l=t.useState(""),u=l[0],o=l[1],d=t.useState(null),s=d[0],c=d[1];t.useEffect((function(){var e=r.value;void 0!==e&&o(e)}),[r.uuid]),t.useEffect((function(){var e=r.errors;e&&c(e)}),[null==r?void 0:r.errors]);var f=r.config;return P.default.createElement(P.default.Fragment,null,P.default.createElement(i.FormControl,{error:null!==s,fullWidth:!0},P.default.createElement(i.InputLabel,{htmlFor:"input-"+r.uuid},r.label),P.default.createElement(i.Input,e.__assign({value:u,onChange:function(e){var t=e.target.value,n=a.validateNode(r,t);a.setValue(r.uuid,t,n),o(t),c(n)},"aria-describedby":"input-"+r.uuid+"-error",multiline:!0,rows:20},null==f?void 0:f.input)),null!==s&&P.default.createElement(i.FormHelperText,{id:"input-"+r.uuid+"-error"},Object.keys(s).map((function(e){return P.default.createElement("span",{key:r.uuid+"-"+e},e)})))))}function K(e){var n=e.node,r=n.type;return t.useContext(V).hasCustomNode(r)?P.default.createElement(H,{node:n}):"line"===r?P.default.createElement(z,{node:n}):"radio"===r?P.default.createElement(G,{node:n}):"checkbox"===r?P.default.createElement(M,{node:n}):"select"===r?P.default.createElement(W,{node:n}):"textarea"===r?P.default.createElement(J,{node:n}):P.default.createElement("div",null,"Not implemented!")}function $(n){var r=n.node,a=n.index,l=n.path,u=n.length,o=t.useContext(V),c=t.useState(!1),f=c[0],p=c[1],m=t.useState(!1),v=m[0],g=m[1],h=t.useState({canAdd:!1}),E=h[0],y=h[1];return t.useEffect((function(){p(!0),y({canAdd:o.canAdd(l)})}),[r.uuid,r.tuuid,r.display]),r.tuuid&&!E.canAdd?P.default.createElement(P.default.Fragment,null):r.tuuid&&E.canAdd?P.default.createElement(i.Box,{display:"flex",flexDirection:"row"},P.default.createElement(i.Box,{p:1,m:1,mr:0,bgcolor:"grey.300"},P.default.createElement(i.Button,{onClick:function(){r.uuid?o.addNode(l,a):o.addNode(l)},disabled:!E.canAdd,component:"span",color:"primary",size:"small",startIcon:P.default.createElement(d.AddBox,null)},"Add "+r.name)),P.default.createElement(i.Box,{p:1,m:1,ml:0,bgcolor:"grey.300",flexGrow:1},r.slider&&P.default.createElement(U,{node:r,path:l,index:a,length:u}))):r.display?"complex"===r.type?P.default.createElement(P.default.Fragment,null,P.default.createElement(i.Box,{display:"flex",flexDirection:"row"},P.default.createElement(i.Box,{flex:"100%",p:1,m:1,bgcolor:"grey.300"},P.default.createElement(i.Button,{onClick:function(){return g(!v)},component:"span",color:"primary",size:"small",startIcon:v?P.default.createElement(d.KeyboardArrowRight,null):P.default.createElement(d.KeyboardArrowDown,null)},a+"."," ",""+r.label)),P.default.createElement(i.Box,{flex:"140px",flexShrink:0,p:1,m:1,mr:1,bgcolor:"grey.300"},P.default.createElement(j,{node:r,index:a,path:l,length:u}))),!v&&P.default.createElement(i.Box,{display:"flex",flexDirection:"row"},P.default.createElement(i.Box,{flex:"150px",p:1,m:1,bgcolor:"grey.100"}),P.default.createElement(i.Box,{flex:"100%",p:1,pr:0,m:1,mr:0},r.children.map((function(t,n){return P.default.createElement($,{node:t,index:n,key:t.uuid||t.tuuid,path:e.__spreadArray(e.__spreadArray([],l),[n]),length:r.children.length})}))))):P.default.createElement(i.Box,{display:"flex",flexDirection:"row"},P.default.createElement(i.Box,{flex:"1 0 20%",p:1,m:1},r.label),P.default.createElement(i.Box,{flex:"80%",p:1,m:1,bgcolor:"grey.400"},P.default.createElement(s.CSSTransition,{in:f,timeout:3e3,classNames:{enter:"animated",enterActive:"fadeIn"}},P.default.createElement(K,{node:r}))),P.default.createElement(i.Box,{flex:"140px",flexShrink:0,p:1,m:1,mr:1,bgcolor:"grey.300"},P.default.createElement(j,{node:r,index:a,path:l,length:u}))):P.default.createElement(P.default.Fragment,null)}var X=function(){function t(e){this.internalPage=new f.BehaviorSubject([]),this.destroy=new f.Subject,this.nodesById={},this.runShowHide=!1,this.errorsList={},this.validator=e}return Object.defineProperty(t.prototype,"staticPage",{get:function(){return t.clone(this.internalPage.getValue())},set:function(e){this.internalPage.next(t.clone(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"page",{get:function(){return this.internalPage.asObservable()},enumerable:!1,configurable:!0}),t.prototype.loadTemplate=function(e,t){this.destroy.next(!0),this.nodesById={},this.subscriptions={},this.runShowHide=!1;var n=this.parse(e,t);this.staticPage=n,this.searchShowHide(n)},t.clone=function(e){return JSON.parse(JSON.stringify(e))},t.prototype.getPage=function(){return this.staticPage},t.prototype.parse=function(t,n,r){var a=this;void 0===n&&(n=[]),void 0===r&&(r=[]);var l=[];return t.forEach((function(t,u){if("complex"===t.type)return a.findAllNodes(t,n).forEach((function(n){var o=n.children,i=e.__rest(n,["children"]),d=a.parse(t.children,null!=o?o:[],e.__spreadArray(e.__spreadArray([],r),[u]));l.push(e.__assign(e.__assign({},i),{children:d}))})),l.push(e.__assign(e.__assign({},t),{tuuid:m.v4()})),l;a.findAllNodes(t,n).forEach((function(e){l.push(e)})),l.push(e.__assign(e.__assign({},t),{tuuid:m.v4()}))})),l},t.prototype.findAllNodes=function(t,n){var r=this,a=t.name,l=t.type,u=n.filter((function(e){return e.name===a&&e.type===l&&e.uuid})).map((function(n){return e.__assign(e.__assign({},t),{value:n.value,uuid:n.uuid,children:n.children,display:!(t.show||t.hide)})}));if(u.length>0){if(!t.multiple){var o=u.shift();return this.nodesById[o.uuid]=null,[o]}return u.forEach((function(e){r.nodesById[e.uuid]=null})),u}if(t.mandatory){var i=m.v4(),d=e.__assign(e.__assign({},t),{display:!(t.show||t.hide),uuid:i});return this.nodesById[d.uuid]=null,[d]}return[]},t.prototype.updateNode=function(t,n,r){var a=this;return t.map((function(t){var l=t.uuid,u=t.children;return l===n?e.__assign(e.__assign({},t),r):Array.isArray(u)?e.__assign(e.__assign({},t),{children:a.updateNode(u,n,r)}):t}))},t.prototype.setValue=function(t,n,r){if(this.staticPage=this.updateNode(this.staticPage,t,{value:n,errors:r}),this.nodesById[t]){var a=e.__assign(e.__assign({},this.nodesById[t].getValue()),{value:n,errors:r});this.nodesById[t].next(a)}else this.nodesById[t]=new f.BehaviorSubject({value:n,errors:r})},t.prototype.setParams=function(t,n){if(this.staticPage=this.updateNode(this.staticPage,t,n),this.nodesById[t]){n.uuid,n.tuuid,n.name,n.type;var r=e.__rest(n,["uuid","tuuid","name","type"]),a=e.__assign(e.__assign({},this.nodesById[t].getValue()),r);this.nodesById[t].next(a)}else this.nodesById[t]=new f.BehaviorSubject(n)},t.prototype.getValue=function(e,t,n){var r,a,l;return null!==(l=null===(a=null===(r=this.nodesById)||void 0===r?void 0:r[e])||void 0===a?void 0:a.getValue())&&void 0!==l?l:{value:t,errors:n}},t.prototype.moveUp=function(n,r){var a=e.__spreadArray([],n),l=a.pop(),u=this.staticPage,o=this.getFromPath(a,u).siblings,i=o[l],d=i.name,s=i.type;if(t.canMoveUpInternal(o,l,s,d)){var c=void 0!==r?r:l-1;o.splice(c,0,o.splice(l,1)[0])}this.staticPage=u},t.prototype.moveDown=function(n,r){var a=e.__spreadArray([],n),l=a.pop(),u=this.staticPage,o=this.getFromPath(a,u),i=o.parent,d=o.siblings,s=d[l],c=s.name,f=s.type;if(t.canMoveDownInternal(d,l,f,c)){var p=void 0!==r?r:l+1;d.splice(p,0,d.splice(l,1)[0]),this.resetIndex(i,d)}this.staticPage=u},t.prototype.canMoveUp=function(n,r,a,l){var u=e.__spreadArray([],n),o=u.pop(),i=this.getFromPath(u,this.staticPage).siblings;return t.canMoveUpInternal(i,o,a,l)},t.prototype.canAdd=function(t){var n=e.__spreadArray([],t),r=n.pop(),a=this.getFromPath(n,this.staticPage).siblings,l=a[r],u=l.name,o=l.type,i=l.multiple,d=l.uuid,s=l.tuuid;if(d&&!i)return!1;if(s&&!i){if(0===r)return!0;var c=a[r-1];if(c.name!==u||c.type!==o||!c.uuid)return!0}return!!i},t.prototype.addNode=function(t,n,r){var a=e.__spreadArray([],t),l=a.pop(),u=this.staticPage,o=this.getFromPath(e.__spreadArray([],a),u).siblings,i=o[l],d=i.name,s=i.type,c=o.find((function(e){return e.name===d&&e.type===s&&!e.uuid&&e.tuuid}));if(!c)return console.error("Template node type: "+s+", name: "+d+" was not found."),void(this.staticPage=u);if(!r){var f=this.initNode(c),p=void 0!==n?n+1:l;return o.splice(p,0,f),this.staticPage=u,void this.searchShowHide(u)}for(var m=1;m<=r;m++){f=this.initNode(c),p=void 0!==n?n:l;o.splice(p,0,f)}this.staticPage=u,this.searchShowHide(u)},t.prototype.deleteNode=function(t,n){var r=e.__spreadArray([],t),a=r.pop(),l=this.staticPage,u=this.getFromPath(e.__spreadArray([],r),l).siblings;if(!n)return this.canDelete(t)?(u.splice(a,1),void(this.staticPage=l)):void(this.staticPage=l);for(var o=1;o<=n;o++){if(!this.canDelete(e.__spreadArray(e.__spreadArray([],r),[a-o])))return void(this.staticPage=l);u.splice(a-o,1)}this.staticPage=l},t.prototype.canDelete=function(n){var r=e.__spreadArray([],n),a=r.pop(),l=this.getFromPath(r,this.staticPage).siblings,u=l[a],o=u.type,i=u.name;return t.canDeleteNodeInternal(l,o,i)},t.canDeleteNodeInternal=function(e,t,n){var r=e.filter((function(e){return e.name===n&&e.type===t&&void 0!==e.uuid})),a=e.find((function(e){return e.name===n&&e.type===t&&void 0!==e.tuuid}));return!a.mandatory||a.mandatory&&r.length>1},t.prototype.initNode=function(t){t.tuuid,t.uuid,t.value;var n=e.__rest(t,["tuuid","uuid","value"]),r=e.__assign(e.__assign({},n),{uuid:m.v4()});return this.parse([n],[r])[0]},t.prototype.canMoveDown=function(n,r,a,l){var u=e.__spreadArray([],n),o=u.pop(),i=this.getFromPath(u,this.staticPage).siblings;return t.canMoveDownInternal(i,o,a,l)},t.canMoveUpInternal=function(e,t,n,r){if(0===t)return!1;var a=e[t-1];return void 0!==a.uuid&&a.name===r&&a.type===n},t.canMoveDownInternal=function(e,t,n,r){if(!e[t+1])return!1;var a=e[t+1];return void 0!==a.uuid&&a.name===r&&a.type===n},t.prototype.getFromPath=function(e,t){if(0===e.length)return{parent:null,siblings:t};var n=e.shift();return e.length>0?this.getFromPath(e,t[n].children):{parent:t[n],siblings:t[n].children}},t.prototype.resetIndex=function(e,t){null!==e?e.children=t.filter((function(){return!0})):this.staticPage=t.filter((function(){return!0}))},t.prototype.getPageErrors=function(){return this.errorsList={},this.staticPage=this.validateNodes(this.staticPage),Object.keys(this.errorsList).length>0?this.errorsList:null},t.prototype.validateNodes=function(t){var n=this;return t.map((function(t){if(!t.uuid||!t.display)return t;var r=n.validator.checkInput(t,t.value);if(r&&(n.errorsList[t.uuid]={uuid:t.uuid,errors:r}),t.children){var a=n.validateNodes(t.children);return e.__assign(e.__assign({},t),{errors:r,children:a})}return e.__assign(e.__assign({},t),{errors:r})}))},t.prototype.validateNode=function(e,t){var n=this.validator.checkInput(e,null!=t?t:e.value);return n?(this.errorsList[e.uuid]={uuid:e.uuid,errors:n},n):(delete this.errorsList[e.uuid],null)},t.prototype.getAllSiblings=function(t){var n=e.__spreadArray([],t),r=this.getFromPath(n,this.staticPage).siblings;return r||[]},t.prototype.getSiblings=function(t){var n=e.__spreadArray([],t),r=n.pop(),a=this.getFromPath(n,this.staticPage).siblings;if(!a[r])return[];var l=a[r],u=l.name,o=l.type;return a.filter((function(e){return e.name===u&&e.type===o&&e.uuid&&!e.tuuid}))},t.parseEquation=function(e){if(e.includes("===")){var n=e.split("==="),r=n[0],a=n[1];return[r=r.trim(),a=a.trim(),t.EQ_STRICT_EQUAL]}if(e.includes("!==")){var l=e.split("!==");r=l[0],a=l[1];return[r=r.trim(),a=a.trim(),t.EQ_STRICT_NOT_EQUAL]}if(e.includes(">=")){var u=e.split(">=");r=u[0],a=u[1];return[r=r.trim(),a=a.trim(),t.EQ_GTE_OR_EQUAL]}if(e.includes(">")){var o=e.split(">");r=o[0],a=o[1];return[r=r.trim(),a=a.trim(),t.EQ_GTE]}if(e.includes("<=")){var i=e.split("<=");r=i[0],a=i[1];return[r=r.trim(),a=a.trim(),t.EQ_LTE_OR_EQUAL]}if(e.includes("<")){var d=e.split("<");r=d[0],a=d[1];return[r=r.trim(),a=a.trim(),t.EQ_LTE]}return[null,null,null]},t.prototype.getEquationNodeIds=function(t,n){var r=this,a=e.__spreadArray([],n);return this.getAllSiblings(a).filter((function(e){return e.name===t&&e.uuid})).map((function(e){var t=e.uuid,n=e.value,a=e.errors;return r.nodesById[t]||(r.nodesById[t]=new f.BehaviorSubject({value:n,errors:a})),e})).map((function(e){return e.uuid}))},t.prototype.searchShowHide=function(n,r){var a=this;void 0===r&&(r=[]),n.forEach((function(n,l){if(n.children&&a.searchShowHide(n.children,e.__spreadArray(e.__spreadArray([],r),[l])),n.show){var u=t.parseEquation(n.show),o=u[0],i=u[1],d=u[2];a.getEquationNodeIds(o,r).forEach((function(e){a.setValue(n.uuid,n.value,n.errors),a.subscribe(n.uuid,e,i,d)}))}}))},t.prototype.subscribe=function(n,r,a,l){var u=this;this.subscriptions[n]||(this.subscriptions[n]={}),!this.subscriptions[n][r]&&this.nodesById[r]&&(this.subscriptions[n][r]=this.nodesById[r].pipe(p.takeUntil(this.destroy)).subscribe((function(){var o=u.nodesById[n].getValue().display;if(e.__spreadArray(e.__spreadArray([],Object.keys(u.subscriptions[n])),[r]).filter((function(e){var n,r,o,i,d,s,c,f,p,m,v,g,h,E,y,_,b,x;return l===t.EQ_STRICT_EQUAL?(null===(o=null===(r=null===(n=u.nodesById)||void 0===n?void 0:n[e])||void 0===r?void 0:r.getValue())||void 0===o?void 0:o.value)===t.convertValue(a):l===t.EQ_STRICT_NOT_EQUAL?(null===(s=null===(d=null===(i=u.nodesById)||void 0===i?void 0:i[e])||void 0===d?void 0:d.getValue())||void 0===s?void 0:s.value)!==t.convertValue(a):l===t.EQ_GTE_OR_EQUAL?Number(null===(p=null===(f=null===(c=u.nodesById)||void 0===c?void 0:c[e])||void 0===f?void 0:f.getValue())||void 0===p?void 0:p.value)>=Number(a):l===t.EQ_GTE?Number(null===(g=null===(v=null===(m=u.nodesById)||void 0===m?void 0:m[e])||void 0===v?void 0:v.getValue())||void 0===g?void 0:g.value)>Number(a):l===t.EQ_LTE_OR_EQUAL?Number(null===(y=null===(E=null===(h=u.nodesById)||void 0===h?void 0:h[e])||void 0===E?void 0:E.getValue())||void 0===y?void 0:y.value)<=Number(a):l===t.EQ_LTE&&Number(null===(x=null===(b=null===(_=u.nodesById)||void 0===_?void 0:_[e])||void 0===b?void 0:b.getValue())||void 0===x?void 0:x.value)<Number(a)})).length>0){if(!0===o)return;u.setParams(n,{display:!0})}else!1!==o&&u.setParams(n,{display:!1})})))},t.convertValue=function(e){return"true"===e.toLowerCase()||"false"!==e.toLowerCase()&&e},t.EQ_STRICT_EQUAL="===",t.EQ_STRICT_NOT_EQUAL="!==",t.EQ_GTE=">",t.EQ_LTE="<",t.EQ_GTE_OR_EQUAL=">==",t.EQ_LTE_OR_EQUAL="<==",t}(),Y=function(){},Z=function(t){function n(e){var n=t.call(this)||this;return n.validatorLib=e,n}return e.__extends(n,t),n.prototype.checkInput=function(t,n){var r=this,a=t.validator,l={};return!t.mandatory||(null!=n?n:t.value)||t.allowEmpty||(l.isEmpty=!0),void 0===a||(Array.isArray(a)||(a=[a]),a.forEach((function(a){var u,o=a,i=[];"object"==typeof a&&(o=a.rule,i=a.params),void 0!==r.validatorLib[o]?(u=r.validatorLib)[o].apply(u,e.__spreadArray([String(null!=n?n:t.value)],i))||(l[a]=!1):console.error("Validation rule "+o+" was not found in the validator library")}))),0===Object.keys(l).length?null:l},n}(Y);function ee(n){var r=n.children,a=n.expectedRole,l=void 0===a?[]:a,u=e.__rest(n,["children","expectedRole"]);return t.useContext(R).accountsService.hasAccess(l)?P.default.cloneElement(r,u):P.default.createElement(P.default.Fragment,null)}var te=v.makeStyles((function(e){return{pendingWrapper:{position:"relative"},pendingLayer:{position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:g.grey.A400,opacity:"0.1"}}}));function ne(t){return P.default.createElement(L.default,e.__assign({elevation:6,variant:"filled"},t))}function re(t,n,r,a){var l=e.__assign({},t),u=n;return a&&(u=a+"_"+n),l[u]=r,l}function ae(e,t){if(!t)return e;var n=new RegExp("^("+t+"_)(.*)$");return Object.keys(e).reduce((function(t,r){var a=n.exec(r);a&&3===a.length&&(t[a[2]]=e[r]);return t}),{})}function le(n){var r=n.column,a=n.prefix,l=y.useRouter(),u=t.useState(null),o=u[0],s=u[1],c=ae(l.query,a),f=c.order_field,p=c.order_dir;t.useEffect((function(){if(f===r)return"desc"===p?void s("desc"):void s("asc");s(null)}),[f,p]);var m=function(t){var n=e.__assign({},l.query);if(o===t)return n=re(n,"order_field",null,a),n=re(n,"order_dir",null,a),void l.push({query:n});n=re(n,"order_field",r,a),n=re(n,"order_dir",t,a),l.push({query:n})};return P.default.createElement(i.Box,{p:1,alignSelf:"flex-end"},P.default.createElement("div",null,P.default.createElement(i.IconButton,{size:"small",onClick:function(){return m("asc")}},P.default.createElement(d.ArrowDropUp,{color:"asc"===o?"secondary":"inherit"})),P.default.createElement(i.IconButton,{size:"small",onClick:function(){return m("desc")}},P.default.createElement(d.ArrowDropDown,{color:"desc"===o?"secondary":"inherit"}))))}var ue=_.makeStyles((function(){return{form_control:{width:"100%"}}}));function oe(e){var n=e.column,r=e.label,a=e.prefix,l=e.sortable,u=y.useRouter(),o=ue(),s=t.useState(u.query[n]||""),c=s[0],m=s[1],v=t.useMemo((function(){return new f.Subject}),[]);t.useEffect((function(){var e=v.pipe(p.distinctUntilChanged(),p.debounceTime(500)).subscribe((function(e){var t=u.query,r=u.pathname,l=re(t,n,e,a);return l=re(l,"page",1,a),f.from(u.push({pathname:r,query:l}))}));return function(){e.unsubscribe(),v.complete()}}),[]);return P.default.createElement(i.TableCell,null,P.default.createElement(i.Box,{display:"flex"},P.default.createElement(i.Box,{p:1,flexGrow:1,alignSelf:"flex-end"},P.default.createElement(i.FormControl,{className:o.form_control},P.default.createElement(i.InputLabel,{htmlFor:n+"-"+r},r),P.default.createElement(i.Input,{id:n+"-"+r,value:c,onChange:function(e){var t=e.target.value;m(t),v.next(t)},endAdornment:c&&P.default.createElement(i.InputAdornment,{position:"end"},P.default.createElement(i.IconButton,{"aria-label":"remove input",onClick:function(e){e.preventDefault(),m(""),v.next("")}},P.default.createElement(d.Backspace,null)))}))),l&&P.default.createElement(le,{column:n,prefix:a})))}function ie(e){var t=e.column,n=e.label,r=e.prefix,a=e.sortable;return P.default.createElement(i.TableCell,null,P.default.createElement(i.Box,{display:"flex"},P.default.createElement(i.Box,{p:1,flexGrow:1,alignSelf:"flex-end"},n),a&&P.default.createElement(le,{column:t,prefix:r})))}var de=v.makeStyles({table:{minWidth:650}});function se(e,t){return t.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((function(e,t){return(e||{})[t]}),e)}var ce=v.makeStyles((function(e){return{root:{"& > *":{marginRight:e.spacing(.5)}},warning:{backgroundColor:g.amber.A400}}}));var fe=function(){function e(){}return e.handleRequest=function(e,t,n){"ok"===e.statusText||void 0===e.data.errors?("function"==typeof n&&n(e),t()):t(e.data.errors)},e.handleError=function(e,t,n){var r;if("function"==typeof n&&n(e),void 0!==e.response){var a=e.response.data;return"string"==typeof a?void t((r={},r[x.FORM_ERROR]=a,r)):void 0!==a.error?void t(a.error):void 0!==a.errors?void t(a.errors):void t(a)}t(e)},e.finalFormResponse=function(e,t){var n=this;return new Promise((function(r){e.toPromise().then((function(e){return n.handleRequest(e,r,t)})).catch((function(e){return n.handleError(e,r,t)}))}))},e}();exports.AbstractValidator=Y,exports.AppContext=R,exports.AppTable=function(e){var t=e.children,n=e.resource,r=e.prefix,a=de(),l=y.useRouter();return P.default.createElement(P.default.Fragment,null,P.default.createElement(i.TableContainer,{component:i.Paper},P.default.createElement(i.Table,{className:a.table,"aria-label":"simple table",size:"small"},P.default.createElement(i.TableHead,null,P.default.createElement(i.TableRow,null,function(e,t){return P.default.Children.map(e,(function(e){var n,r;if(P.default.isValidElement(e)){if(null===(n=null==e?void 0:e.props)||void 0===n?void 0:n.searchable)return P.default.createElement(oe,{label:e.props.label,prefix:t,column:e.props.column,sortable:e.props.sortable});if(void 0!==typeof(null===(r=null==e?void 0:e.props)||void 0===r?void 0:r.label))return P.default.createElement(ie,{label:e.props.label,prefix:t,column:e.props.column,sortable:e.props.sortable})}return P.default.createElement(i.TableCell,null)}))}(t,r))),P.default.createElement(i.TableBody,null,n&&n.data.map((function(e,n){return P.default.createElement(i.TableRow,{key:(null==e?void 0:e.id)||n,hover:!0},function(e,t){return P.default.Children.map(e,(function(e){return P.default.isValidElement(e)?P.default.cloneElement(e,{record:t,value:t}):e}))}(t,e))}))))),P.default.createElement(i.TablePagination,{rowsPerPageOptions:[15,25,50,100],component:"div",count:(null==n?void 0:n.total)||0,rowsPerPage:(null==n?void 0:n.per_page)||15,page:(null==n?void 0:n.current_page)-1||0,onChangePage:function(e,t){var n=l.query,a=l.pathname,u=re(n,"page",t+1,r);l.push({pathname:a,query:u},void 0,{shallow:!0})},onChangeRowsPerPage:function(){}}))},exports.AuthGuard=function(e){var n=e.children;return t.useContext(R).storeService.has("AccountsService","profile")?P.default.createElement(P.default.Fragment,null,n({x:"y"})):P.default.createElement("div",null,"unauthorized")},exports.Column=function(e){var t=e.align,n=e.record,r=e.column,a=e.children;return a?P.default.createElement(i.TableCell,{align:t},a(se(n,r),n)):P.default.createElement(i.TableCell,{align:t},se(n,r))},exports.ColumnActions=function(e){var n,r,a=e.align,l=e.record,u=e.column,o=e.path,s=e.handleDelete,c=e.requiredRole,f=ce(),p=y.useRouter(),m=t.useState(!1),v=m[0],g=m[1];return P.default.createElement(i.TableCell,{align:a},P.default.createElement("div",{className:f.root},P.default.createElement(ee,{expectedRole:c?[(n={},n[c]="update",n)]:[]},P.default.createElement(i.Button,{size:"small",variant:"outlined",color:"primary",onClick:function(){var e=null!=o?o:p.pathname;p.push({pathname:e+"/"+l[u]})},startIcon:P.default.createElement(d.Edit,null)},"Edit")),s&&P.default.createElement(ee,{expectedRole:c?[(r={},r[c]="delete",r)]:[]},P.default.createElement(i.Button,{className:"warning",size:"small",variant:"outlined",color:"secondary",onClick:function(){return g(!0)}},P.default.createElement(d.Delete,null)))),P.default.createElement(O,{open:v,handleClose:function(e){g(!1),e&&s&&s(l)},title:"Remove entity?",content:"Are you sure you want to remove this entity?"}))},exports.ColumnBoolean=function(e){var t=e.align,n=e.record,r=e.column;return P.default.createElement(i.TableCell,{align:t},n[r]?P.default.createElement(d.Done,null):null)},exports.ColumnDate=function(e){var n=e.align,r=e.record,a=e.column,l=e.format,u=e.locale,o=t.useContext(R).locale,d=t.useState(),s=d[0],c=d[1],f=se(r,a);return t.useMemo((function(){c("fromNow"!==l?q.default(f).locale(u||o).format(l||"L HH:mm:ss"):q.default(f).locale(u||o).fromNow())}),[f,u,l]),P.default.createElement(i.TableCell,{align:n},s)},exports.ConfirmDialog=O,exports.Controls=j,exports.CustomNode=H,exports.Editor=function(e){var n=e.parser,r=e.page,a=e.customNodes,l=t.useState([]),u=l[0],o=l[1];t.useEffect((function(){var e=n.page.subscribe((function(e){o(e)}));return function(){e.unsubscribe()}}),[JSON.stringify(r)]);var i=n.page;return P.default.createElement(V.Provider,{value:{moveUp:function(e,t){n.moveUp(e,t)},canMoveUp:function(e,t,r,a){return n.canMoveUp(e,t,r,a)},moveDown:function(e,t){n.moveDown(e,t)},canMoveDown:function(e,t,r,a){return n.canMoveDown(e,t,r,a)},canAdd:function(e){return n.canAdd(e)},addNode:function(e,t,r){n.addNode(e,t,r)},canDelete:function(e){return n.canDelete(e)},deleteNode:function(e,t){n.deleteNode(e,t)},setValue:function(e,t,r){return n.setValue(e,t,r)},getValue:function(e,t,r){return n.getValue(e,t,r)},validateNode:function(e,t){return n.validateNode(e,t)},hasCustomNode:function(e){return!!(null==a?void 0:a[e])},getCustomNode:function(e){return a[e]},getSiblings:function(e){return n.getSiblings(e)},getEquationNodeIds:function(e,t){return n.getEquationNodeIds(e,t)},page:i}},u.map((function(e,t){return P.default.createElement($,{key:e.uuid||e.tuuid,index:t,node:e,path:[t],length:u.length})})))},exports.EditorContext=V,exports.FormResponse=fe,exports.Header=ie,exports.HeaderSearch=oe,exports.LineNode=z,exports.NodeWrapper=$,exports.Parser=X,exports.Pending=function(e){var t=e.loading,n=e.children,r=te();return P.default.createElement("div",{className:r.pendingWrapper},t&&P.default.createElement("div",{className:r.pendingLayer}),n)},exports.RoleGuard=ee,exports.Snackbar=function(){var n=t.useState({open:!1,type:"info",message:null}),r=n[0],a=n[1],l=t.useContext(R).snackbarService;t.useEffect((function(){var t=l.subject.subscribe((function(t){t&&a(e.__assign({open:!0},t))}));return function(){t.unsubscribe()}}),[]);var u=function(e,t){"clickaway"!==t&&a({open:!1,type:"info",message:null})};return P.default.createElement(F.default,{open:r.open,autoHideDuration:6e3,onClose:u},P.default.createElement(ne,{onClose:u,severity:r.type},r.message))},exports.Sortable=le,exports.Validator=Z,exports.getPrefixedValues=ae,exports.getQueryParam=function(e,t,n){return n&&!e[n]&&(e[n]={}),n?e[n+"_"+t]:e[t]},exports.getValue=se,exports.setQueryParam=re;
//# sourceMappingURL=index.min.js.map
