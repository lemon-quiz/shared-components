"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react"),n=require("@material-ui/core/Button"),r=require("@material-ui/core/Dialog"),a=require("@material-ui/core/DialogActions"),l=require("@material-ui/core/DialogContent"),u=require("@material-ui/core/DialogContentText"),o=require("@material-ui/core/DialogTitle"),i=require("@material-ui/core"),d=require("@material-ui/icons"),c=require("react-transition-group"),s=require("@material-ui/icons/ArrowDropUp"),f=require("uuid"),p=require("@material-ui/styles"),m=require("@material-ui/core/colors"),v=require("@material-ui/core/Snackbar"),g=require("@material-ui/lab/Alert"),h=require("next/router"),y=require("rxjs"),E=require("rxjs/operators"),x=require("@material-ui/core/styles"),b=require("moment"),_=require("final-form");function C(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function A(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var P=A(t),S=C(t),N=C(n),k=C(r),w=C(a),D=C(l),F=C(u),q=C(o),B=C(s),I=C(v),M=C(g),T=C(b),L=P.createContext({});function R(e){var t=e.open,n=e.title,r=e.content,a=e.submitLabel,l=e.cancelLabel,u=e.handleClose;return S.default.createElement(k.default,{open:t,onClose:function(){return u(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},S.default.createElement(q.default,{id:"alert-dialog-title"},n),S.default.createElement(D.default,null,S.default.createElement(F.default,{id:"alert-dialog-description",dangerouslySetInnerHTML:{__html:r}})),S.default.createElement(w.default,null,S.default.createElement(N.default,{onClick:function(){return u(!1)},color:"primary"},null!=l?l:"Cancel"),S.default.createElement(N.default,{onClick:function(){return u(!0)},color:"primary",autoFocus:!0},null!=a?a:"Submit")))}L.Provider,L.Consumer;var V=S.default.createContext(null);function O(e){return""+e}function j(n){var r=n.node,a=n.path,l=n.index,u=n.length,o=t.useContext(V),d=t.useState(0),c=d[0],s=d[1],f=t.useState(0),p=f[0],m=f[1];t.useEffect((function(){var e=o.getSiblings(a);s(e.length),m(e.length)}),[l,u]);var v=r.config;return S.default.createElement(i.Slider,e.__assign({value:c,getAriaValueText:O,"aria-labelledby":"discrete-slider",valueLabelDisplay:"auto",step:1,marks:!0,min:0,max:100,onChangeCommitted:function(e,t){if(t>p){var n=t-p;return o.addNode(a,void 0,n),void m(t)}if(t<p){var r=p-t;o.deleteNode(a,r),m(t)}},onChange:function(e,t){s(t)}},null==v?void 0:v.slider))}function U(e){var n=e.node,r=e.index,a=e.path,l=e.length,u=t.useContext(V),o=t.useState({canMoveUp:!1,canMoveDown:!1,canAdd:!1,canDelete:!1}),c=o[0],s=o[1];return t.useEffect((function(){s({canMoveUp:u.canMoveUp(a,r,n.type,n.name),canMoveDown:u.canMoveDown(a,r,n.type,n.name),canAdd:u.canAdd(a),canDelete:u.canDelete(a)})}),[r,l]),S.default.createElement(S.default.Fragment,null,S.default.createElement(i.IconButton,{onClick:function(){u.moveUp(a)},disabled:!c.canMoveUp,component:"span",color:"primary",size:"small"},S.default.createElement(B.default,null)),S.default.createElement(i.IconButton,{onClick:function(){u.moveDown(a)},disabled:!c.canMoveDown,component:"span",color:"primary",size:"small"},S.default.createElement(d.ArrowDropDown,null)),S.default.createElement(i.IconButton,{onClick:function(){n.uuid?u.addNode(a,r):u.addNode(a)},disabled:!c.canAdd,component:"span",color:"primary",size:"small"},S.default.createElement(d.AddBox,null)),S.default.createElement(i.IconButton,{onClick:function(){u.deleteNode(a)},disabled:!c.canDelete,component:"span",color:"primary",size:"small"},S.default.createElement(d.Delete,null)))}function z(n){var r=n.node,a=t.useContext(V),l=t.useState(!1),u=l[0],o=l[1],d=t.useState(null),c=d[0],s=d[1];t.useEffect((function(){var e=r.uuid,t=r.value,n=r.errors,l=a.getValue(e,t,n),u=l.value,i=l.errors;void 0!==u&&o(u),void 0!==i&&s(i)}),[null==r?void 0:r.errors]);var f=function(t){o((function(n){var l,u=t.target,o=u.checked,i=u.value,d=e.__assign({},n);(null===(l=r.options)||void 0===l?void 0:l.length)>0?("object"!=typeof d&&(d={}),d[i]=o):d=o;var c=a.validateNode(r,d);return a.setValue(r.uuid,d,c),s(c),d}))},p=function(e){var t,n;return(null===(t=r.options)||void 0===t?void 0:t.length)>0?null!==(n=u[e])&&void 0!==n&&n:!!u},m=r.config;return S.default.createElement(S.default.Fragment,null,S.default.createElement(i.FormControl,{error:null!==c,fullWidth:!0},S.default.createElement(i.FormGroup,null,(r.options||[{value:!1,desc:r.name}]).map((function(t){return S.default.createElement(i.FormControlLabel,e.__assign({key:r.name+"-"+String(t.value),control:S.default.createElement(i.Checkbox,e.__assign({checked:p(t.value),onChange:f,name:t.desc,value:t.value},null==m?void 0:m.checkbox)),label:t.desc},null==m?void 0:m.label))}))),null!==c&&S.default.createElement(i.FormHelperText,{id:"input-"+r.uuid+"-error"},Object.keys(c).map((function(e){return S.default.createElement("span",{key:r.uuid+"-"+e},e)})))))}function H(e){var n=e.node,r=t.useContext(V),a=n.type,l=r.getCustomNode(a);return l?S.default.createElement(l,{node:n}):S.default.createElement(S.default.Fragment,null)}function W(n){var r=n.node,a=t.useContext(V),l=t.useState(""),u=l[0],o=l[1],d=t.useState(null),c=d[0],s=d[1],f=t.useState(!1);f[0];var p=f[1];t.useEffect((function(){var e=r.uuid,t=r.value,n=r.errors,l=a.getValue(e,t,n),u=l.value,i=l.errors;void 0!==u&&o(u),void 0!==i&&s(i)}),[null==r?void 0:r.errors]);var m=r.config;return S.default.createElement(S.default.Fragment,null,S.default.createElement(i.FormControl,{error:null!==c,fullWidth:!0},S.default.createElement(i.InputLabel,{htmlFor:"input-"+r.uuid},r.name),S.default.createElement(i.Input,e.__assign({id:"input-"+r.uuid,value:u,onChange:function(e){var t=e.target.value,n=a.validateNode(r,t);a.setValue(r.uuid,t,n),o(t),s(n),p(!0)},"aria-describedby":"input-"+r.uuid+"-error"},null==m?void 0:m.input)),null!==c&&S.default.createElement(i.FormHelperText,{id:"input-"+r.uuid+"-error"},Object.keys(c).map((function(e){return S.default.createElement("span",{key:r.uuid+"-"+e},e)})))))}function G(n){var r,a=n.node,l=t.useContext(V),u=t.useState(""),o=u[0],d=u[1],c=t.useState(null),s=c[0],f=c[1];t.useEffect((function(){var e=a.uuid,t=a.value,n=a.errors,r=l.getValue(e,t,n),u=r.value,o=r.errors;void 0!==u&&d(u),void 0!==o&&f(o)}),[null==a?void 0:a.errors]);var p=a.config;return S.default.createElement(S.default.Fragment,null,S.default.createElement(i.FormControl,{error:null!==s,fullWidth:!0},S.default.createElement(i.RadioGroup,e.__assign({value:o,onChange:function(e){var t=e.target.value,n=l.validateNode(a,t);l.setValue(a.uuid,t,n),d(t),f(n)}},null==p?void 0:p.group),null===(r=null==a?void 0:a.options)||void 0===r?void 0:r.map((function(t){var n=t.value,r=t.desc;return S.default.createElement(i.FormControlLabel,e.__assign({key:n,value:n,control:S.default.createElement(i.Radio,e.__assign({},null==p?void 0:p.radio)),label:r},null==p?void 0:p.label))}))),null!==s&&S.default.createElement(i.FormHelperText,{id:"input-"+a.uuid+"-error"},Object.keys(s).map((function(e){return S.default.createElement("span",{key:a.uuid+"-"+e},e)})))))}function J(n){var r,a=n.node,l=t.useContext(V),u=t.useState(""),o=u[0],d=u[1],c=t.useState(null),s=c[0],f=c[1];t.useEffect((function(){var e=a.uuid,t=a.value,n=a.errors,r=l.getValue(e,t,n),u=r.value,o=r.errors;void 0!==u&&d(u),void 0!==o&&f(o)}),[null==a?void 0:a.errors]);var p=a.config;return S.default.createElement(S.default.Fragment,null,S.default.createElement(i.FormControl,{error:null!==s,fullWidth:!0},S.default.createElement(i.Select,e.__assign({value:o,onChange:function(e){var t=e.target.value,n=l.validateNode(a,t);l.setValue(a.uuid,t,n),d(t),f(n)}},null==a?void 0:a.select),null===(r=null==a?void 0:a.options)||void 0===r?void 0:r.map((function(t){var n=t.value,r=t.desc;return S.default.createElement(i.MenuItem,e.__assign({key:n,value:n},null==p?void 0:p.option),r)}))),null!==s&&S.default.createElement(i.FormHelperText,{id:"input-"+a.uuid+"-error"},Object.keys(s).map((function(e){return S.default.createElement("span",{key:a.uuid+"-"+e},e)})))))}function K(n){var r=n.node,a=t.useContext(V),l=t.useState(""),u=l[0],o=l[1],d=t.useState(null),c=d[0],s=d[1],f=t.useState(!1);f[0];var p=f[1];t.useEffect((function(){var e=r.uuid,t=r.value,n=r.errors,l=a.getValue(e,t,n),u=l.value,i=l.errors;void 0!==u&&o(u),void 0!==i&&s(i)}),[null==r?void 0:r.errors]);var m=r.config;return S.default.createElement(S.default.Fragment,null,S.default.createElement(i.FormControl,{error:null!==c,fullWidth:!0},S.default.createElement(i.InputLabel,{htmlFor:"input-"+r.uuid},r.name),S.default.createElement(i.Input,e.__assign({value:u,onChange:function(e){var t=e.target.value,n=a.validateNode(r,t);a.setValue(r.uuid,t,n),o(t),s(n),p(!0)},"aria-describedby":"input-"+r.uuid+"-error",multiline:!0,rows:20},null==m?void 0:m.input)),null!==c&&S.default.createElement(i.FormHelperText,{id:"input-"+r.uuid+"-error"},Object.keys(c).map((function(e){return S.default.createElement("span",{key:r.uuid+"-"+e},e)})))))}function Q(e){var n=e.node,r=n.type;return t.useContext(V).hasCustomNode(r)?S.default.createElement(H,{node:n}):"line"===r?S.default.createElement(W,{node:n}):"radio"===r?S.default.createElement(G,{node:n}):"checkbox"===r?S.default.createElement(z,{node:n}):"select"===r?S.default.createElement(J,{node:n}):"textarea"===r?S.default.createElement(K,{node:n}):S.default.createElement("div",null,"Not implemented!")}function $(n){var r=n.node,a=n.index,l=n.path,u=n.length,o=t.useContext(V),s=t.useState(!1),f=s[0],p=s[1],m=t.useState(!1),v=m[0],g=m[1],h=t.useState({canAdd:!1}),y=h[0],E=h[1];return t.useEffect((function(){p(!0),E({canAdd:o.canAdd(l)})}),[a,u]),r.tuuid&&!y.canAdd?S.default.createElement(S.default.Fragment,null):r.tuuid&&y.canAdd?S.default.createElement(i.Box,{display:"flex",flexDirection:"row"},S.default.createElement(i.Box,{p:1,m:1,mr:0,bgcolor:"grey.300"},S.default.createElement(i.Button,{onClick:function(){r.uuid?o.addNode(l,a):o.addNode(l)},disabled:!y.canAdd,component:"span",color:"primary",size:"small",startIcon:S.default.createElement(d.AddBox,null)},"Add "+r.name)),S.default.createElement(i.Box,{p:1,m:1,ml:0,bgcolor:"grey.300",flexGrow:1},r.slider&&S.default.createElement(j,{node:r,path:l,index:a,length:u}))):"complex"===r.type?S.default.createElement(S.default.Fragment,null,S.default.createElement(i.Box,{display:"flex",flexDirection:"row"},S.default.createElement(i.Box,{flex:"100%",p:1,m:1,bgcolor:"grey.300"},S.default.createElement(i.Button,{onClick:function(){return g(!v)},component:"span",color:"primary",size:"small",startIcon:v?S.default.createElement(d.KeyboardArrowRight,null):S.default.createElement(d.KeyboardArrowDown,null)},a+"."," ",""+r.name)),S.default.createElement(i.Box,{flex:"140px",flexShrink:0,p:1,m:1,mr:1,bgcolor:"grey.300"},S.default.createElement(U,{node:r,index:a,path:l,length:u}))),!v&&S.default.createElement(i.Box,{display:"flex",flexDirection:"row"},S.default.createElement(i.Box,{flex:"150px",p:1,m:1,bgcolor:"grey.100"}),S.default.createElement(i.Box,{flex:"100%",p:1,pr:0,m:1,mr:0},r.children.map((function(t,n){return S.default.createElement($,{node:t,index:n,key:t.uuid||t.tuuid,path:e.__spreadArray(e.__spreadArray([],l),[n]),length:r.children.length})}))))):S.default.createElement(i.Box,{display:"flex",flexDirection:"row"},S.default.createElement(i.Box,{flex:"1 0 20%",p:1,m:1},r.name),S.default.createElement(i.Box,{flex:"80%",p:1,m:1,bgcolor:"grey.400"},S.default.createElement(c.CSSTransition,{in:f,timeout:3e3,classNames:{enter:"animated",enterActive:"fadeIn"}},S.default.createElement(Q,{node:r}))),S.default.createElement(i.Box,{flex:"140px",flexShrink:0,p:1,m:1,mr:1,bgcolor:"grey.300"},S.default.createElement(U,{node:r,index:a,path:l,length:u})))}var X=function(){function t(e){this.initPage=[],this.valueList={},this.errorsList={},this.validator=e}return t.prototype.loadTemplate=function(e,t){this.initPage=this.parse(e,t),this.valueList={}},t.prototype.getPage=function(){return JSON.parse(JSON.stringify(this.initPage))},t.prototype.parse=function(n,r,a){var l=this;return void 0===r&&(r=[]),void 0===a&&(a=[]),n.forEach((function(n){if("complex"===n.type)return t.findAllNodes(n,r).forEach((function(t){var r=t.children,u=e.__rest(t,["children"]),o=l.parse(n.children,null!=r?r:[]);a.push(e.__assign(e.__assign({},u),{children:o}))})),a.push(e.__assign(e.__assign({},n),{tuuid:f.v4()})),a;t.findAllNodes(n,r).forEach((function(e){a.push(e)})),a.push(e.__assign(e.__assign({},n),{tuuid:f.v4()}))})),a},t.findAllNodes=function(t,n){var r=t.name,a=t.type,l=n.filter((function(e){return e.name===r&&e.type===a&&e.uuid})).map((function(n){return e.__assign(e.__assign({},t),{value:n.value,uuid:n.uuid,children:n.children})}));return l.length>0?t.multiple?l:[l.shift()]:t.mandatory?[e.__assign(e.__assign({},t),{uuid:f.v4()})]:[]},t.prototype.moveUp=function(n,r){var a=e.__spreadArray([],n),l=a.pop(),u=this.getFromPath(a,this.initPage),o=u.parent,i=u.siblings,d=i[l],c=d.name,s=d.type;if(t.canMoveUpInternal(i,l,s,c)){var f=void 0!==r?r:l-1;i.splice(f,0,i.splice(l,1)[0]),this.resetIndex(o,i)}return this.resetIndex(o,i),this.getPage()},t.prototype.moveDown=function(n,r){var a=e.__spreadArray([],n),l=a.pop(),u=this.getFromPath(a,this.initPage),o=u.parent,i=u.siblings,d=i[l],c=d.name,s=d.type;if(t.canMoveDownInternal(i,l,s,c)){var f=void 0!==r?r:l+1;i.splice(f,0,i.splice(l,1)[0]),this.resetIndex(o,i)}return this.getPage()},t.prototype.canMoveUp=function(n,r,a,l){var u=e.__spreadArray([],n),o=u.pop(),i=this.getFromPath(u,this.initPage).siblings;return t.canMoveUpInternal(i,o,a,l)},t.prototype.canAdd=function(t){var n=e.__spreadArray([],t),r=n.pop(),a=this.getFromPath(n,this.initPage).siblings,l=a[r],u=l.name,o=l.type,i=l.multiple,d=l.uuid,c=l.tuuid;if(d&&!i)return!1;if(c&&!i){if(0===r)return!0;var s=a[r-1];if(s.name!==u||s.type!==o||!s.uuid)return!0}return!!i},t.prototype.addNode=function(t,n,r){var a=e.__spreadArray([],t),l=a.pop(),u=this.getFromPath(e.__spreadArray([],a),this.initPage).siblings,o=u[l],i=o.name,d=o.type,c=u.find((function(e){return e.name===i&&e.type===d&&!e.uuid&&e.tuuid}));if(!c)return console.error("Template node type: "+d+", name: "+i+" was not found."),this.getPage();if(!r){var s=this.initNode(c),f=void 0!==n?n+1:l;return u.splice(f,0,s),this.getPage()}for(var p=1;p<=r;p++){s=this.initNode(c),f=void 0!==n?n:l;u.splice(f,0,s)}return this.getPage()},t.prototype.deleteNode=function(t,n){var r=e.__spreadArray([],t),a=r.pop(),l=this.getFromPath(e.__spreadArray([],r),this.initPage).siblings;if(!n)return this.canDelete(t)?(l.splice(a,1),this.getPage()):this.getPage();for(var u=1;u<=n;u++){if(!this.canDelete(e.__spreadArray(e.__spreadArray([],r),[a-u])))return this.getPage();l.splice(a-u,1)}return this.getPage()},t.prototype.canDelete=function(n){var r=e.__spreadArray([],n),a=r.pop(),l=this.getFromPath(r,this.initPage).siblings,u=l[a],o=u.type,i=u.name;return t.canDeleteNodeInternal(l,o,i)},t.canDeleteNodeInternal=function(e,t,n){var r=e.filter((function(e){return e.name===n&&e.type===t&&void 0!==e.uuid})),a=e.find((function(e){return e.name===n&&e.type===t&&void 0!==e.tuuid}));return!a.mandatory||a.mandatory&&r.length>1},t.prototype.initNode=function(t){t.tuuid,t.uuid,t.value;var n=e.__rest(t,["tuuid","uuid","value"]),r=e.__assign(e.__assign({},n),{uuid:f.v4()});return this.parse([n],[r])[0]},t.prototype.canMoveDown=function(n,r,a,l){var u=e.__spreadArray([],n),o=u.pop(),i=this.getFromPath(u,this.initPage).siblings;return t.canMoveDownInternal(i,o,a,l)},t.canMoveUpInternal=function(e,t,n,r){if(0===t)return!1;var a=e[t-1];return void 0!==a.uuid&&a.name===r&&a.type===n},t.canMoveDownInternal=function(e,t,n,r){if(!e[t+1])return!1;var a=e[t+1];return void 0!==a.uuid&&a.name===r&&a.type===n},t.prototype.getFromPath=function(e,t){if(0===e.length)return{parent:null,siblings:t};var n=e.shift();return e.length>0?this.getFromPath(e,t[n].children):{parent:t[n],siblings:t[n].children}},t.prototype.resetIndex=function(e,t){null!==e?e.children=t.filter((function(){return!0})):this.initPage=t.filter((function(){return!0}))},t.prototype.setValue=function(e,t,n){this.valueList[e]={id:e,value:t,errors:n},this.initPage=this.updateNode(this.initPage,e,{value:t,errors:n})},t.prototype.getValue=function(e,t,n){var r,a;return null!==(a=null===(r=this.valueList)||void 0===r?void 0:r[e])&&void 0!==a?a:{value:t,errors:n}},t.prototype.updateNode=function(t,n,r){var a=this;return t.map((function(t){var l=t.uuid,u=t.children;return l===n?e.__assign(e.__assign({},t),r):Array.isArray(u)?e.__assign(e.__assign({},t),{children:a.updateNode(u,n,r)}):t}))},t.prototype.getPageErrors=function(){return this.errorsList={},this.initPage=this.validateNodes(this.initPage),Object.keys(this.errorsList).length>0?this.errorsList:null},t.prototype.validateNodes=function(t){var n=this;return t.map((function(t){if(!t.uuid)return t;var r=n.validator.checkInput(t,t.value);if(r&&(n.errorsList[t.uuid]={uuid:t.uuid,errors:r}),t.children){var a=n.validateNodes(t.children);return e.__assign(e.__assign({},t),{errors:r,children:a})}return e.__assign(e.__assign({},t),{errors:r})}))},t.prototype.validateNode=function(e,t){var n=this.validator.checkInput(e,null!=t?t:e.value);return n?(this.errorsList[e.uuid]={uuid:e.uuid,errors:n},n):(delete this.errorsList[e.uuid],null)},t.prototype.getSiblings=function(t){var n=e.__spreadArray([],t),r=n.pop(),a=this.getFromPath(n,this.initPage).siblings,l=a[r],u=l.name,o=l.type;return a.filter((function(e){return e.name===u&&e.type===o&&e.uuid&&!e.tuuid}))},t.prototype.getHash=function(e){void 0===e&&(e=0);for(var t=JSON.stringify(this.initPage),n=3735928559^e,r=1103547991^e,a=0,l=void 0;a<t.length;a++)l=t.charCodeAt(a),n=Math.imul(n^l,2654435761),r=Math.imul(r^l,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),4294967296*(2097151&(r=Math.imul(r^r>>>16,2246822507)^Math.imul(n^n>>>13,3266489909)))+(n>>>0)},t}(),Y=function(){},Z=function(t){function n(e){var n=t.call(this)||this;return n.validatorLib=e,n}return e.__extends(n,t),n.prototype.checkInput=function(t,n){var r=this,a=t.validator,l={};return!t.mandatory||(null!=n?n:t.value)||t.allowEmpty||(l.isEmpty=!0),void 0===a||(Array.isArray(a)||(a=[a]),a.forEach((function(a){var u,o=a,i=[];"object"==typeof a&&(o=a.rule,i=a.params),void 0!==r.validatorLib[o]?(u=r.validatorLib)[o].apply(u,e.__spreadArray([String(null!=n?n:t.value)],i))||(l[a]=!1):console.error("Validation rule "+o+" was not found in the validator library")}))),0===Object.keys(l).length?null:l},n}(Y);function ee(n){var r=n.children,a=n.expectedRole,l=void 0===a?[]:a,u=e.__rest(n,["children","expectedRole"]);return t.useContext(L).accountsService.hasAccess(l)?S.default.cloneElement(r,u):S.default.createElement(S.default.Fragment,null)}var te=p.makeStyles((function(e){return{pendingWrapper:{position:"relative"},pendingLayer:{position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:m.grey.A400,opacity:"0.1"}}}));function ne(t){return S.default.createElement(M.default,e.__assign({elevation:6,variant:"filled"},t))}function re(t,n,r,a){var l=e.__assign({},t),u=n;return a&&(u=a+"_"+n),l[u]=r,l}function ae(e,t){if(!t)return e;var n=new RegExp("^("+t+"_)(.*)$");return Object.keys(e).reduce((function(t,r){var a=n.exec(r);a&&3===a.length&&(t[a[2]]=e[r]);return t}),{})}function le(n){var r=n.column,a=n.prefix,l=h.useRouter(),u=t.useState(null),o=u[0],c=u[1],s=ae(l.query,a),f=s.order_field,p=s.order_dir;t.useEffect((function(){if(f===r)return"desc"===p?void c("desc"):void c("asc");c(null)}),[f,p]);var m=function(t){var n=e.__assign({},l.query);if(o===t)return n=re(n,"order_field",null,a),n=re(n,"order_dir",null,a),void l.push({query:n});n=re(n,"order_field",r,a),n=re(n,"order_dir",t,a),l.push({query:n})};return S.default.createElement(i.Box,{p:1,alignSelf:"flex-end"},S.default.createElement("div",null,S.default.createElement(i.IconButton,{size:"small",onClick:function(){return m("asc")}},S.default.createElement(d.ArrowDropUp,{color:"asc"===o?"secondary":"inherit"})),S.default.createElement(i.IconButton,{size:"small",onClick:function(){return m("desc")}},S.default.createElement(d.ArrowDropDown,{color:"desc"===o?"secondary":"inherit"}))))}var ue=x.makeStyles((function(){return{form_control:{width:"100%"}}}));function oe(e){var n=e.column,r=e.label,a=e.prefix,l=e.sortable,u=h.useRouter(),o=ue(),c=t.useState(u.query[n]||""),s=c[0],f=c[1],p=t.useMemo((function(){return new y.Subject}),[]);t.useEffect((function(){var e=p.pipe(E.distinctUntilChanged(),E.debounceTime(500)).subscribe((function(e){var t=u.query,r=u.pathname,l=re(t,n,e,a);return l=re(l,"page",1,a),y.from(u.push({pathname:r,query:l}))}));return function(){e.unsubscribe(),p.complete()}}),[]);return S.default.createElement(i.TableCell,null,S.default.createElement(i.Box,{display:"flex"},S.default.createElement(i.Box,{p:1,flexGrow:1,alignSelf:"flex-end"},S.default.createElement(i.FormControl,{className:o.form_control},S.default.createElement(i.InputLabel,{htmlFor:n+"-"+r},r),S.default.createElement(i.Input,{id:n+"-"+r,value:s,onChange:function(e){var t=e.target.value;f(t),p.next(t)},endAdornment:s&&S.default.createElement(i.InputAdornment,{position:"end"},S.default.createElement(i.IconButton,{"aria-label":"remove input",onClick:function(e){e.preventDefault(),f(""),p.next("")}},S.default.createElement(d.Backspace,null)))}))),l&&S.default.createElement(le,{column:n,prefix:a})))}function ie(e){var t=e.column,n=e.label,r=e.prefix,a=e.sortable;return S.default.createElement(i.TableCell,null,S.default.createElement(i.Box,{display:"flex"},S.default.createElement(i.Box,{p:1,flexGrow:1,alignSelf:"flex-end"},n),a&&S.default.createElement(le,{column:t,prefix:r})))}var de=p.makeStyles({table:{minWidth:650}});function ce(e,t){return t.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((function(e,t){return(e||{})[t]}),e)}var se=p.makeStyles((function(e){return{root:{"& > *":{marginRight:e.spacing(.5)}},warning:{backgroundColor:m.amber.A400}}}));var fe=function(){function e(){}return e.handleRequest=function(e,t,n){"ok"===e.statusText||void 0===e.data.errors?("function"==typeof n&&n(e),t()):t(e.data.errors)},e.handleError=function(e,t,n){var r;if("function"==typeof n&&n(e),void 0!==e.response){var a=e.response.data;return"string"==typeof a?void t((r={},r[_.FORM_ERROR]=a,r)):void 0!==a.error?void t(a.error):void 0!==a.errors?void t(a.errors):void t(a)}t(e)},e.finalFormResponse=function(e,t){var n=this;return new Promise((function(r){e.toPromise().then((function(e){return n.handleRequest(e,r,t)})).catch((function(e){return n.handleError(e,r,t)}))}))},e}();exports.AbstractValidator=Y,exports.AppContext=L,exports.AppTable=function(e){var t=e.children,n=e.resource,r=e.prefix,a=de(),l=h.useRouter();return S.default.createElement(S.default.Fragment,null,S.default.createElement(i.TableContainer,{component:i.Paper},S.default.createElement(i.Table,{className:a.table,"aria-label":"simple table",size:"small"},S.default.createElement(i.TableHead,null,S.default.createElement(i.TableRow,null,function(e,t){return S.default.Children.map(e,(function(e){var n,r;if(S.default.isValidElement(e)){if(null===(n=null==e?void 0:e.props)||void 0===n?void 0:n.searchable)return S.default.createElement(oe,{label:e.props.label,prefix:t,column:e.props.column,sortable:e.props.sortable});if(void 0!==typeof(null===(r=null==e?void 0:e.props)||void 0===r?void 0:r.label))return S.default.createElement(ie,{label:e.props.label,prefix:t,column:e.props.column,sortable:e.props.sortable})}return S.default.createElement(i.TableCell,null)}))}(t,r))),S.default.createElement(i.TableBody,null,n&&n.data.map((function(e,n){return S.default.createElement(i.TableRow,{key:(null==e?void 0:e.id)||n,hover:!0},function(e,t){return S.default.Children.map(e,(function(e){return S.default.isValidElement(e)?S.default.cloneElement(e,{record:t,value:t}):e}))}(t,e))}))))),S.default.createElement(i.TablePagination,{rowsPerPageOptions:[15,25,50,100],component:"div",count:(null==n?void 0:n.total)||0,rowsPerPage:(null==n?void 0:n.per_page)||15,page:(null==n?void 0:n.current_page)-1||0,onChangePage:function(e,t){var n=l.query,a=l.pathname,u=re(n,"page",t+1,r);l.push({pathname:a,query:u},void 0,{shallow:!0})},onChangeRowsPerPage:function(){}}))},exports.AuthGuard=function(e){var n=e.children;return t.useContext(L).storeService.has("AccountsService","profile")?S.default.createElement(S.default.Fragment,null,n({x:"y"})):S.default.createElement("div",null,"unauthorized")},exports.Column=function(e){var t=e.align,n=e.record,r=e.column,a=e.children;return a?S.default.createElement(i.TableCell,{align:t},a(ce(n,r),n)):S.default.createElement(i.TableCell,{align:t},ce(n,r))},exports.ColumnActions=function(e){var n,r,a=e.align,l=e.record,u=e.column,o=e.path,c=e.handleDelete,s=e.requiredRole,f=se(),p=h.useRouter(),m=t.useState(!1),v=m[0],g=m[1];return S.default.createElement(i.TableCell,{align:a},S.default.createElement("div",{className:f.root},S.default.createElement(ee,{expectedRole:s?[(n={},n[s]="update",n)]:[]},S.default.createElement(i.Button,{size:"small",variant:"outlined",color:"primary",onClick:function(){var e=null!=o?o:p.pathname;p.push({pathname:e+"/"+l[u]})},startIcon:S.default.createElement(d.Edit,null)},"Edit")),c&&S.default.createElement(ee,{expectedRole:s?[(r={},r[s]="delete",r)]:[]},S.default.createElement(i.Button,{className:"warning",size:"small",variant:"outlined",color:"secondary",onClick:function(){return g(!0)}},S.default.createElement(d.Delete,null)))),S.default.createElement(R,{open:v,handleClose:function(e){g(!1),e&&c&&c(l)},title:"Remove entity?",content:"Are you sure you want to remove this entity?"}))},exports.ColumnBoolean=function(e){var t=e.align,n=e.record,r=e.column;return S.default.createElement(i.TableCell,{align:t},n[r]?S.default.createElement(d.Done,null):null)},exports.ColumnDate=function(e){var n=e.align,r=e.record,a=e.column,l=e.format,u=e.locale,o=t.useContext(L).locale,d=t.useState(),c=d[0],s=d[1],f=ce(r,a);return t.useMemo((function(){s("fromNow"!==l?T.default(f).locale(u||o).format(l||"L HH:mm:ss"):T.default(f).locale(u||o).fromNow())}),[f,u,l]),S.default.createElement(i.TableCell,{align:n},c)},exports.ConfirmDialog=R,exports.Controls=U,exports.CustomNode=H,exports.Editor=function(e){var n=e.parser,r=e.page,a=e.customNodes,l=t.useState([]),u=l[0],o=l[1];return t.useEffect((function(){o(r)}),[JSON.stringify(r)]),S.default.createElement(V.Provider,{value:{moveUp:function(e,t){o(n.moveUp(e,t))},canMoveUp:function(e,t,r,a){return n.canMoveUp(e,t,r,a)},moveDown:function(e,t){o(n.moveDown(e,t))},canMoveDown:function(e,t,r,a){return n.canMoveDown(e,t,r,a)},canAdd:function(e){return n.canAdd(e)},addNode:function(e,t,r){o(n.addNode(e,t,r))},canDelete:function(e){return n.canDelete(e)},deleteNode:function(e,t){o(n.deleteNode(e,t))},setValue:function(e,t,r){return n.setValue(e,t,r)},getValue:function(e,t,r){return n.getValue(e,t,r)},validateNode:function(e,t){return n.validateNode(e,t)},hasCustomNode:function(e){return!!(null==a?void 0:a[e])},getCustomNode:function(e){return a[e]},getSiblings:function(e){return n.getSiblings(e)}}},u.map((function(e,t){return S.default.createElement($,{key:e.uuid||e.tuuid,index:t,node:e,path:[t],length:u.length})})))},exports.EditorContext=V,exports.FormResponse=fe,exports.Header=ie,exports.HeaderSearch=oe,exports.LineNode=W,exports.NodeWrapper=$,exports.Parser=X,exports.Pending=function(e){var t=e.loading,n=e.children,r=te();return S.default.createElement("div",{className:r.pendingWrapper},t&&S.default.createElement("div",{className:r.pendingLayer}),n)},exports.RoleGuard=ee,exports.Snackbar=function(){var n=t.useState({open:!1,type:"info",message:null}),r=n[0],a=n[1],l=t.useContext(L).snackbarService;t.useEffect((function(){var t=l.subject.subscribe((function(t){t&&a(e.__assign({open:!0},t))}));return function(){t.unsubscribe()}}),[]);var u=function(e,t){"clickaway"!==t&&a({open:!1,type:"info",message:null})};return S.default.createElement(I.default,{open:r.open,autoHideDuration:6e3,onClose:u},S.default.createElement(ne,{onClose:u,severity:r.type},r.message))},exports.Sortable=le,exports.Validator=Z,exports.getPrefixedValues=ae,exports.getQueryParam=function(e,t,n){return n&&!e[n]&&(e[n]={}),n?e[n+"_"+t]:e[t]},exports.getValue=ce,exports.setQueryParam=re;
//# sourceMappingURL=index.min.js.map
