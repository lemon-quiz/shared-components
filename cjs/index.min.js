"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@material-ui/core"),t=require("react"),r=require("next/router"),l=require("@material-ui/styles"),a=require("rxjs"),n=require("rxjs/operators"),o=require("@material-ui/icons"),u=require("@material-ui/core/styles"),i=require("@material-ui/core/colors"),c=require("@material-ui/core/Button"),s=require("@material-ui/core/Dialog"),d=require("@material-ui/core/DialogActions"),f=require("@material-ui/core/DialogContent"),m=require("@material-ui/core/DialogContentText"),p=require("@material-ui/core/DialogTitle"),b=require("moment"),E=require("@material-ui/core/Snackbar"),g=require("@material-ui/lab/Alert"),v=require("final-form"),_=require("validator");function y(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function h(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var l=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,l.get?l:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var x=y(t),C=h(t),q=y(c),j=y(s),O=y(d),w=y(f),R=y(m),k=y(p),A=y(b),S=y(E),T=y(g),z=y(_);function P(e,t,r,l){const a={...e};let n=t;return l&&(n=`${l}_${t}`),a[n]=r,a}var $=Object.freeze({__proto__:null,default:P});function D(e,t){if(!t)return e;const r=new RegExp(`^(${t}_)(.*)$`);return Object.keys(e).reduce(((t,l)=>{const a=r.exec(l);if(a&&3===a.length){t[a[2]]=e[l]}return t}),{})}var B=Object.freeze({__proto__:null,default:D});function F({column:l,prefix:a}){const n=r.useRouter(),[u,i]=t.useState(null),{order_field:c,order_dir:s}=D(n.query,a);t.useEffect((()=>{if(c===l)return"desc"===s?void i("desc"):void i("asc");i(null)}),[c,s]);const d=e=>{let t={...n.query};if(u===e)return t=P(t,"order_field",null,a),t=P(t,"order_dir",null,a),void n.push({query:t});t=P(t,"order_field",l,a),t=P(t,"order_dir",e,a),n.push({query:t})};return x.default.createElement(e.Box,{p:1,alignSelf:"flex-end"},x.default.createElement("div",null,x.default.createElement(e.IconButton,{size:"small",onClick:()=>d("asc")},x.default.createElement(o.ArrowDropUp,{color:"asc"===u?"secondary":"inherit"})),x.default.createElement(e.IconButton,{size:"small",onClick:()=>d("desc")},x.default.createElement(o.ArrowDropDown,{color:"desc"===u?"secondary":"inherit"}))))}const N=u.makeStyles((()=>({form_control:{width:"100%"}})));function I({column:l,label:u,prefix:i,sortable:c}){const s=r.useRouter(),d=N(),[f,m]=t.useState(s.query[l]||""),p=t.useMemo((()=>new a.Subject),[]);t.useEffect((()=>{const e=p.pipe(n.distinctUntilChanged(),n.debounceTime(500)).subscribe((e=>{const{query:t,pathname:r}=s;let n=P(t,l,e,i);return n=P(n,"page",1,i),a.from(s.push({pathname:r,query:n}))}));return()=>{e.unsubscribe(),p.complete()}}),[]);return x.default.createElement(e.TableCell,null,x.default.createElement(e.Box,{display:"flex"},x.default.createElement(e.Box,{p:1,flexGrow:1,alignSelf:"flex-end"},x.default.createElement(e.FormControl,{className:d.form_control},x.default.createElement(e.InputLabel,{htmlFor:`${l}-${u}`},u),x.default.createElement(e.Input,{id:`${l}-${u}`,value:f,onChange:e=>{const t=e.target.value;m(t),p.next(t)},endAdornment:f&&x.default.createElement(e.InputAdornment,{position:"end"},x.default.createElement(e.IconButton,{"aria-label":"remove input",onClick:e=>{e.preventDefault(),m(""),p.next("")}},x.default.createElement(o.Backspace,null)))}))),c&&x.default.createElement(F,{column:l,prefix:i})))}function H({column:t,label:r,prefix:l,sortable:a}){return x.default.createElement(e.TableCell,null,x.default.createElement(e.Box,{display:"flex"},x.default.createElement(e.Box,{p:1,flexGrow:1,alignSelf:"flex-end"},r),a&&x.default.createElement(F,{column:t,prefix:l})))}const L=l.makeStyles({table:{minWidth:650}});function M(e,t){return t.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce(((e,t)=>(e||{})[t]),e)}var V=Object.freeze({__proto__:null,default:M});function G({open:e,title:t,content:r,submitLabel:l,cancelLabel:a,handleClose:n}){return x.default.createElement(j.default,{open:e,onClose:()=>n(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},x.default.createElement(k.default,{id:"alert-dialog-title"},t),x.default.createElement(w.default,null,x.default.createElement(R.default,{id:"alert-dialog-description",dangerouslySetInnerHTML:{__html:r}})),x.default.createElement(O.default,null,x.default.createElement(q.default,{onClick:()=>n(!1),color:"primary"},null!=a?a:"Cancel"),x.default.createElement(q.default,{onClick:()=>n(!0),color:"primary",autoFocus:!0},null!=l?l:"Submit")))}var W=Object.freeze({__proto__:null,default:G});const Q=C.createContext({});const U=Q.Provider,Z=Q.Consumer;var J=Object.freeze({__proto__:null,withAppContext:function(e){return t=>C.createElement(Q.Consumer,null,(r=>C.createElement(e,Object.assign({context:r},t))))},AppProvider:U,AppConsumer:Z,default:Q});function K({children:e,expectedRole:r=[],...l}){const{accountsService:a}=t.useContext(Q);return a.hasAccess(r)?x.default.cloneElement(e,l):x.default.createElement(x.default.Fragment,null)}var X=Object.freeze({__proto__:null,default:K});const Y=l.makeStyles((e=>({root:{"& > *":{marginRight:e.spacing(.5)}},warning:{backgroundColor:i.amber.A400}})));var ee=Object.freeze({__proto__:null,AppTable:function({children:t,resource:l,prefix:a}){const n=L(),o=r.useRouter();return x.default.createElement(x.default.Fragment,null,x.default.createElement(e.TableContainer,{component:e.Paper},x.default.createElement(e.Table,{className:n.table,"aria-label":"simple table",size:"small"},x.default.createElement(e.TableHead,null,x.default.createElement(e.TableRow,null,((t,r)=>x.default.Children.map(t,(t=>{var l,a;if(x.default.isValidElement(t)){if(null===(l=null==t?void 0:t.props)||void 0===l?void 0:l.searchable)return x.default.createElement(I,{label:t.props.label,prefix:r,column:t.props.column,sortable:t.props.sortable});if(void 0!==typeof(null===(a=null==t?void 0:t.props)||void 0===a?void 0:a.label))return x.default.createElement(H,{label:t.props.label,prefix:r,column:t.props.column,sortable:t.props.sortable})}return x.default.createElement(e.TableCell,null)})))(t,a))),x.default.createElement(e.TableBody,null,l&&l.data.map(((r,l)=>x.default.createElement(e.TableRow,{key:(null==r?void 0:r.id)||l,hover:!0},function(e,t){return x.default.Children.map(e,(e=>x.default.isValidElement(e)?x.default.cloneElement(e,{record:t,value:t}):e))}(t,r))))))),x.default.createElement(e.TablePagination,{rowsPerPageOptions:[15,25,50,100],component:"div",count:(null==l?void 0:l.total)||0,rowsPerPage:(null==l?void 0:l.per_page)||15,page:(null==l?void 0:l.current_page)-1||0,onChangePage:(e,t)=>{const{query:r,pathname:l}=o,n=P(r,"page",t+1,a);o.push({pathname:l,query:n},void 0,{shallow:!0})},onChangeRowsPerPage:()=>{}}))},Column:function({align:t,record:r,column:l,children:a}){return a?x.default.createElement(e.TableCell,{align:t},a(M(r,l),r)):x.default.createElement(e.TableCell,{align:t},M(r,l))},ColumnActions:function({align:l,record:a,column:n,path:u,handleDelete:i,requiredRole:c}){const s=Y(),d=r.useRouter(),[f,m]=t.useState(!1);return x.default.createElement(e.TableCell,{align:l},x.default.createElement("div",{className:s.root},x.default.createElement(K,{expectedRole:c?[{[c]:"update"}]:[]},x.default.createElement(e.Button,{size:"small",variant:"outlined",color:"primary",onClick:()=>{const e=null!=u?u:d.pathname;d.push({pathname:`${e}/${a[n]}`})},startIcon:x.default.createElement(o.Edit,null)},"Edit")),i&&x.default.createElement(K,{expectedRole:c?[{[c]:"delete"}]:[]},x.default.createElement(e.Button,{className:"warning",size:"small",variant:"outlined",color:"secondary",onClick:()=>m(!0)},x.default.createElement(o.Delete,null)))),x.default.createElement(G,{open:f,handleClose:e=>{m(!1),e&&i&&i(a)},title:"Remove entity?",content:"Are you sure you want to remove this entity?"}))},ColumnBoolean:function({align:t,record:r,column:l}){return x.default.createElement(e.TableCell,{align:t},r[l]?x.default.createElement(o.Done,null):null)},ColumnDate:function({align:r,record:l,column:a,format:n,locale:o}){const{locale:u}=t.useContext(Q),[i,c]=t.useState(),s=M(l,a);return t.useMemo((()=>{c("fromNow"!==n?A.default(s).locale(o||u).format(n||"L HH:mm:ss"):A.default(s).locale(o||u).fromNow())}),[s,o,n]),x.default.createElement(e.TableCell,{align:r},i)},Header:H,HeaderSearch:I,Sortable:F});var te=Object.freeze({__proto__:null,default:function({children:e}){const{storeService:r}=t.useContext(Q);return r.has("AccountsService","profile")?x.default.createElement(x.default.Fragment,null,e({x:"y"})):x.default.createElement("div",null,"unauthorized")}});const re=l.makeStyles((e=>({pendingWrapper:{position:"relative"},pendingLayer:{position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:i.grey.A400,opacity:"0.1"}})));var le=Object.freeze({__proto__:null,default:function({loading:e,children:t}){const r=re();return x.default.createElement("div",{className:r.pendingWrapper},e&&x.default.createElement("div",{className:r.pendingLayer}),t)}});function ae(e){return x.default.createElement(T.default,Object.assign({elevation:6,variant:"filled"},e))}var ne=Object.freeze({__proto__:null,default:function(){const[e,r]=t.useState({open:!1,type:"info",message:null}),{snackbarService:l}=t.useContext(Q);t.useEffect((()=>{const e=l.subject.subscribe((e=>{e&&r({open:!0,...e})}));return()=>{e.unsubscribe()}}),[]);const a=(e,t)=>{"clickaway"!==t&&r({open:!1,type:"info",message:null})};return x.default.createElement(S.default,{open:e.open,autoHideDuration:6e3,onClose:a},x.default.createElement(ae,{onClose:a,severity:e.type},e.message))}});var oe=Object.freeze({__proto__:null,FormResponse:class{static handleRequest(e,t,r){"ok"===e.statusText||void 0===e.data.errors?("function"==typeof r&&r(e),t()):t(e.data.errors)}static handleError(e,t,r){if("function"==typeof r&&r(e),void 0!==e.response){const{response:{data:r}}=e;return"string"==typeof r?void t({[v.FORM_ERROR]:r}):void 0!==r.error?void t(r.error):void 0!==r.errors?void t(r.errors):void t(r)}t(e)}static finalFormResponse(e,t){return new Promise((r=>{e.toPromise().then((e=>this.handleRequest(e,r,t))).catch((e=>this.handleError(e,r,t)))}))}}});var ue=Object.freeze({__proto__:null,getCurrentValue:function(e,t,r){return r&&!e[r]&&(e[r]={}),r?e[`${r}_${t}`]:e[t]}});class ie{}ie.required=(e,t,r)=>{var l;z.default.isEmpty(null!==(l=r[t])&&void 0!==l?l:"")&&(e[t]=`${t} is required`)},ie.boolean=(e,t,r)=>{!1!==r[t]&&!0!==r[t]&&(e[t]=`${t} should be true or false.`)},ie.password=(e,t,r)=>{var l;if(z.default.isEmpty(null!==(l=r[t])&&void 0!==l?l:""))return void(e[t]=`${t} is required`);new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})").test(r[t])||(e[t]=`${t} is not a strong enough. At least 1 uppercase character, 1 numeric character and 1 special character.`),r[t]!==r[`${t}_repeat`]&&(e[t]="passwords do not match.")},ie.email=(e,t,r)=>{var l;z.default.isEmpty(null!==(l=r[t])&&void 0!==l?l:"")||z.default.isEmail(r[t])||(e[t]="Not a valid e-mailaddress ")},ie.test=(e,t)=>{const r={};return Object.keys(t).forEach((l=>{const a=t[l];Array.isArray(a)&&a.forEach((t=>{"function"==typeof t&&t(r,l,e),"object"==typeof z.default&&Array.isArray(e[l])&&e[l].forEach(((e,a)=>{const n=ie.test(e,t);Object.keys(n).length>0&&(r[l]||(r[l]=[]),r[l][a]=n)}))}))})),r};var ce=Object.freeze({__proto__:null,default:ie});exports.AppContext=J,exports.AuthGuard=te,exports.ConfirmDialog=W,exports.FormResponse=oe,exports.Pending=le,exports.RoleGuard=X,exports.Snackbar=ne,exports.Table=ee,exports.Validator=ce,exports.getPrefixedValues=B,exports.getQueryParam=ue,exports.getValue=V,exports.setQueryParam=$;
//# sourceMappingURL=index.min.js.map
